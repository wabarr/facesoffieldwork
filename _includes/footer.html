<footer class="my-footer z-depth-2">
    <p class="footer-p">
		<div class="row">
			<div class="col s4 l2 offset-l3">
				<a href="http://twitter.com/facesfieldwork" class="waves-effect waves-teal btn-flat"><i class="fa fa-twitter"></i></a>
			</div>
			<div class="col s4 l2">
				<a href="{{site.contributeURL}}" class="waves-effect waves-teal btn-flat teal lighten-3">Submit</a>
			</div>
			<div class="col s4 l2">
				<a href="/gallery/" class="waves-effect waves-teal btn-flat"><i class="fa fa-home"></i></a>
			</div>
		</div>
    </p>
</footer>
<script type="text/javascript" src="{{ "/styles/jquery.js" | prepend: site.baseurl }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>


<!-- Facebook -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7&appId=262402210442311";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
   
<!-- Google Analytics -->

{% if site.g_analytics %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.g_analytics }}', 'auto');
  ga('send', 'pageview');

</script>
{% endif %}

<script src="/js/jquery.expander.min.js"></script>
<script>
$('div.expander').expander({
  slicePoint: 200
});


$('.more-link').click(function() {
	var url = $( this ).closest(".post-container").children(".post-url-link").attr("href");
	{% if site.g_analytics %}
	ga('send', {
	  hitType: 'event',
	  eventCategory: 'posts',
	  eventAction: 'read-more',
	  eventLabel: url
	});
	{% endif %}
});
</script>

<script>
$( document ).ready(function() {
	
	// keep track of which post indices have been displayed
	var postsDisplayed = 0
	var posts;
	
	//if there is a post skeleton in the DOM,  use AJAX to get data for all posts and save to variable
	if($("#featured-face-skeleton").length>0){
		$.ajax({
		    url: "/posts-json",
			// required to make the request synchronous
			// otherwise the variable won't have the data in it!
			async: false,
			dataType: "json",
		    success: function(data) {
		        posts = data;
		    }
		});
	}
	
	
	//returns single object matching a particular url from posts
	function getPost(posts, url) {
		for (var i = 0; i < posts.length; i++) {
			if(posts[i].url === url) {
				return posts[i];
			};
		};
	};
	
	function populateFeature(post, parentDiv, scroll=false){
		$(parentDiv).hide();
		if(post.youtube){
			$(parentDiv + " .featured-face-img-row").before("<div class='row featured-face-youtube' style='position:relative;height:0;padding-bottom:56.25%'><iframe src='" + post.youtube + "{{site.youtubeparams}}' width='640' height='360' frameborder='0' style='position:absolute;width:100%;height:100%;left:0' allowfullscreen></iframe></div>")
			$(parentDiv + " .featured-face-img-row").hide()
		} else {
			$(parentDiv + " .featured-face-youtube").remove()
			$(parentDiv + " .featured-face-img").remove();
			// when we scroll down and trigger the loading of more content, we clone the first post 
			// removing the entire image tag helps prevent the first post image from momentarily showing
			// if new img is slow to load
			$(parentDiv + " .featured-face-img-row").html("<img src='" + post.imgurfilepath + "' class='featured-face-img'/>")
		}
			
		$(parentDiv + " .featured-face-content").html(post.content);	
		$(parentDiv + " .featured-face-title").html(post.author + " - " + post.title);
		$(parentDiv + " .post-location").html("<span class='my-tag'>" + post.location + "</span>");
		if(post.twitterhandle){
			var twittercontent = "<i class='fa fa-twitter' aria-hidden='true'></i> <a class='twitter-link' href='https://twitter.com/" + post.twitterhandle + "'>@" + post.twitterhandle + "</a>"
			$(parentDiv + " .featured-face-twitter").html(twittercontent);
		} else {
			$(parentDiv + " .featured-face-twitter").html("");
		}
		$(parentDiv + " .featured-face-tags .chip").remove()
		$.each(post.tags, function(index,value){
			$(parentDiv + " .featured-face-tags").append("<div class='chip'>" + value + "</div>")
		});
		//make the div visible
		$(parentDiv).show();
		if(scroll === true) {
			$('html, body').animate({
		        scrollTop: $("#featured-face").offset().top
		    }, 1000);
		}
		};
	
	// if the page is index page then populate with first post data
	if($("#index-identifier").length > 0){
		populateFeature(getPost(posts,posts[0].url), parentDiv="#featured-face-skeleton");
		{% if site.g_analytics %}
		ga('send', {
			hitType: 'event',
			eventCategory: 'scroll-loads',
			eventAction: 'first-face-loaded-before-scroll',
			eventLabel: posts[postsDisplayed].url
		});
		{% endif %}
		postsDisplayed++;		
		
	};
	
	//detects when an element has been scrolled to
	function isScrolledIntoView(elem)
	{
	    var docViewTop = $(window).scrollTop();
	    var docViewBottom = docViewTop + $(window).height();

	    var elemTop = $(elem).offset().top;
	    var elemBottom = elemTop + $(elem).height();

	    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
	}
	
	$(".modal").modal({
		ready: function(){
			{% if site.g_analytics %}
			ga('send', {
				hitType: 'event',
				eventCategory: 'calltoaction',
				eventAction: 'calltoaction-modal-loaded'
			});
			{% endif %}
		},
		complete: function() {
			//remove the modal from the DOM after it has been opened so it only will get shown once
			$("#modal-calltoaction").remove()
		}
	});
	
	
	//put event on scroll to fire when a div is reached
	if($("#load-more-content-trigger").length > 0){
		$(window).on('scroll', function() {       
		    if(isScrolledIntoView($("#load-more-content-trigger"))===true) {
				var newID = "loadedPost" + postsDisplayed
				if(postsDisplayed < posts.length) {
					$("#featured-face-skeleton").clone().attr("id",newID).insertBefore($("#load-more-content-trigger"));
					populateFeature(posts[postsDisplayed], parentDiv="#"+newID);
					{% if site.g_analytics %}
					ga('send', {
						hitType: 'event',
						eventCategory: 'scroll-loads',
						eventAction: 'new-face-loaded',
						eventLabel: posts[postsDisplayed].url
					});
					{% endif %}
					postsDisplayed++;
				}
				if(postsDisplayed === 5){
					$('#modal-calltoaction').modal('open');
				}
		    }
		});
	}
	
	
	
});
	
</script>
