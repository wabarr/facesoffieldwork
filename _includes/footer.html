<footer class="my-footer z-depth-2">
    <p class="footer-p">
		<a href="/about/" class="waves-effect waves-teal btn-flat"><i class="fa fa-question"></i></a>
		<a href="{{site.contributeURL}}" class="waves-effect waves-teal btn-flat">Share your story</a>
		<a href="/map/" class="waves-effect waves-teal btn-flat"><i class="fa fa-globe"></i></a>
		<!-- <a href="https://twitter.com/{{ site.twitter_username }}"class="waves-effect waves-teal btn-flat my-twitter-link"><i class="fa fa-twitter"></i></a>
		<a href="https://facebook.com/facesoffieldwork"class="waves-effect waves-teal btn-flat"><i class="fa fa-facebook"></i></a> -->
    </p>
</footer>
<script type="text/javascript" src="{{ "/styles/jquery.js" | prepend: site.baseurl }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>


<!-- Facebook -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7&appId=262402210442311";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
   
<!-- Google Analytics -->

{% if site.g_analytics %}
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', '{{ site.g_analytics }}', 'auto');
  ga('send', 'pageview');

</script>
{% endif %}

<script src="/js/jquery.expander.min.js"></script>
<script>
$('div.expander').expander({
  slicePoint: 200
});


$('.more-link').click(function() {
	var url = $( this ).closest(".post-container").children(".post-url-link").attr("href");
	ga('send', {
	  hitType: 'event',
	  eventCategory: 'posts',
	  eventAction: 'read-more',
	  eventLabel: url
	});
});
</script>

<script>
$( document ).ready(function() {
	
	// keep track of which post indices have been displayed
	var postsDisplayed = 0
	
	//if there is a post skeleton in the DOM,  use AJAX to get data for all posts and save to variable
	if($("#featured-face-skeleton").length>0){
		var posts;
		$.ajax({
		    url: '/posts.json/',
			// required to make the request synchronous
			// otherwise the variable won't have the data in it!
			async: false,
		    success: function(data) {
		        posts = data;
		    }
		});
	}
	
	
	//returns single object matching a particular url from posts
	function getPost(posts, url) {
		for (var i = 0; i < posts.length; i++) {
			if(posts[i].url === url) {
				return posts[i];
			};
		};
	};
	
	function populateFeature(post, parentDiv, scroll=false){
		$(parentDiv + " .featured-face-img").attr("src",post.imgurfilepath);	
		$(parentDiv + " .featured-face-content").html(post.content);	
		$(parentDiv + " .fb-comments").attr("data-href","http://facesoffieldwork.com" + post.url);
		$(parentDiv + " .featured-face-author").html(post.author);
		$(parentDiv + " .featured-face-title").html(post.title);
		//make the div visible
		$(parentDiv).css("display",'block');
		if(scroll === true) {
			$('html, body').animate({
		        scrollTop: $("#featured-face").offset().top
		    }, 1000);
		}
		};

	$(".gallery-link").click(function( event ) {
		event.preventDefault();
		populateFeature(getPost(posts,$( this ).attr("href")), parentDiv="#featured-face-skeleton", scroll=true);
		ga('send', {
			hitType: 'event',
			eventCategory: 'gallery',
			eventAction: 'gallery-click',
			eventLabel: $( this ).attr("href")
		});
	});
	
	// if the page is a single post page, with a post-identifier div, then populate with matching post data
	if($("#post-identifier").length > 0){
		populateFeature(getPost(posts,window.location.pathname), parentDiv="#featured-face-skeleton");
	};
	
	// if the page is index page then populate with first post data
	if($("#index-identifier").length > 0){
		populateFeature(getPost(posts,posts[0].url), parentDiv="#featured-face-skeleton");
		postsDisplayed++;		
		
	};
	
	//detects when an element has been scrolled to
	function isScrolledIntoView(elem)
	{
	    var docViewTop = $(window).scrollTop();
	    var docViewBottom = docViewTop + $(window).height();

	    var elemTop = $(elem).offset().top;
	    var elemBottom = elemTop + $(elem).height();

	    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
	}
	
	//put event on scroll to fire when a div is reached
	if($("#load-more-content-trigger").length > 0){
		$(window).on('scroll', function() {       
		    if(isScrolledIntoView($("#load-more-content-trigger"))===true) {
				var newID = "loadedPost" + postsDisplayed
				if(postsDisplayed < posts.length) {
					$("#featured-face-skeleton").clone().attr("id",newID).insertBefore($("#load-more-content-trigger"));
					populateFeature(posts[postsDisplayed], parentDiv="#"+newID);
					postsDisplayed++;
				}
				
		    }
		});
	}
	
	
	
});
	
</script>
